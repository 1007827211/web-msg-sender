<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link href="main.css" rel="stylesheet" type="text/css" />
<script src='//cdn.bootcss.com/socket.io/1.3.7/socket.io.js'></script>
<script src='//cdn.bootcss.com/jquery/1.11.3/jquery.js'></script>
<script src='/notify.js'></script>
</head>
<body>
<div id="uid_box"></div>
<div id="online_box"></div>
<div class="notification sticky hide">
        <p id="content"> </p>
        <a class="close" href="javascript:">
            <img src="/icon-close.png" /></a>
    </div>
<script>
$(document).ready(function () {
	// 连接服务端
    var socket = io('http://'+document.domain+':2120');
	// 使用时替换成真实的uid，这里方便演示使用时间戳
    var uid = Date.parse(new Date());
	// 连接后登录
    socket.on('connect', function(){
    	socket.emit('login', uid);
    });
    $('#uid_box').html('当前用户uid：'+uid+'，<br>可以通过 http://'+document.domain+':2121?type=publish&to='+uid+'&content=推送内容 向这个用户推送数据<br>可以通过 http://'+document.domain+':2121?type=publish&to=&content=推送内容 向所有在线用户推送数据);
    socket.on('new_msg', function(msg){
         $('#content').html('收到消息：'+msg);
         $('.notification.sticky').notify();
    });
    socket.on('update_online_count', function(count){
        $('#online_box').html('当前在线' + count + '人在线<br>');
    });
});
</script>
</body>
</html>
